# Feature Selection

## Factor Analysis of Mixed Data
We first do feature selection using factor analysis of mixed data (FAMD), which is a variant of PCA that can be directly applied to data sets with both categorical and numerical variables without using one-hot encoding beforehand. We use the package `PCAmixdata` described in @chavent2022.

To apply the `PCAmix` function, we split the data into categorical variables and numerical variables.
```{r,echo=TRUE, warning=FALSE}
library("PCAmixdata")
split_data <- splitmix(cleaned_data)
X1 <- split_data$X.quanti
X2 <- split_data$X.quali
PCA_mix_result <- PCAmix(X.quanti=X1, X.quali=X2, rename.level = TRUE, graph=FALSE)
```

The following output shows the percent contribution of each categorical variable to the first five dimensions.
```{r,echo=TRUE}
PCA_mix_result$quali$contrib.pct
```

The following output shows the percent contribution of the numerical variable to the first five dimensions.
```{r,echo=TRUE}
PCA_mix_result$quanti$contrib.pct
```
Altogether, we see that the top three contributors for the first dimension are Risk, T, and Response. The top three contributors for the second dimension are Risk, T, and Stage. The top three contributors for the third dimension are T, Pathology, and Physical Examination. This suggests that Risk, T, Response, Stage, and Pathology are significant features.

The significant features identified by FAMD are very consistent with the significant features (Response, Gender, Risk, Age, Pathology) proposed by the paper @borzooei2023.

## Principal Components Analysis
We also do feature selection using PCA, which is a common approach to encode most of the variability in a data set with a smaller number of features. Before applying PCA, we first use one-hot encoding to transform all categorical variables into numerical variables.

```{r,echo=TRUE, warning=FALSE}
pca_recipe <- cleaned_data |>
  recipe(Recurred ~ .) |>
  step_normalize(all_numeric()) |>
  step_dummy(all_nominal()) |>
  step_corr(threshold = 0.6) |>
  step_pca(all_predictors())

# Estimate parameters from the recipe
pca_prep <- prep(pca_recipe)

# Extract the PCs
extract_pcs <- tidy(pca_prep, 4)
```

@fig-pcs shows the top five features for each of the first six principal components. PCA shows that no history of radiotherapy, age, and single nodular goiter right/left or multinodular goiter in the physical examination are significant features.

```{r message=FALSE, fig.width=15, fig.height=6}
#| column: page
#| label: fig-pcs
#| fig-cap: "Top features for the first six principal components"
#| fig-alt: "Top features for the first six principal components"

extract_pcs |>
  filter(component %in% paste0('PC', 1:6)) |>
  group_by(component) |>
  top_n(5, abs(value)) |>
  ungroup() |>
  mutate(terms = reorder_within(terms, abs(value), component)) |>
  ggplot(aes(abs(value), terms, fill = value > 0)) +
  geom_col() +
  facet_wrap(~component, scales = 'free_y') +
  scale_y_reordered() +
  labs(
    x = "Absolute value of contribution",
    y = NULL, fill = "Is Positive?"
  )
```

If needed, we can examine the scree plot to decide how many principal components to use.

